<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #chart {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <h1>Population Growth Visualization</h1>
    <label for="yearSelect">Select Year:</label>
    <select id="yearSelect"></select>
    <svg id="chart"></svg>

    <script>
        const svg = d3.select("#chart")
                      .attr("width", 800)
                      .attr("height", 600);
        
        const projection = d3.geoMercator()
                             .scale(150)
                             .translate([400, 300]);

        const path = d3.geoPath().projection(projection);

        const colorScale = d3.scaleQuantize()
                             .range(d3.schemeBlues[9]);

        let populationData = [];
        let geoData;

        Promise.all([
            d3.csv("WorldPopulationFrom1998to2012.csv"),
            d3.json("https://raw.githubusercontent.com/datasets/geo-boundaries-world-110m/master/countries.geojson")
        ]).then(([csvData, geoJson]) => {
            populationData = csvData;
            geoData = geoJson;

            // Create year options
            const years = d3.range(1998, 2013);
            const yearSelect = d3.select("#yearSelect");
            yearSelect.selectAll("option")
                      .data(years)
                      .enter()
                      .append("option")
                      .text(d => d)
                      .attr("value", d => d);

            yearSelect.on("change", updateMap);
            updateMap();

            function updateMap() {
                const selectedYear = yearSelect.property("value");

                // Convert population data to a format suitable for the map
                const populationByCountry = {};
                populationData.forEach(d => {
                    populationByCountry[d["Country Name"]] = +d[selectedYear].replace(/,/g, "") || 0;
                });

                // Set the color domain based on population data
                colorScale.domain([0, d3.max(populationData, d => +d[selectedYear].replace(/,/g, "") || 0)]);

                svg.selectAll("path").remove();

                svg.selectAll("path")
                   .data(geoData.features)
                   .enter().append("path")
                   .attr("d", path)
                   .attr("fill", d => {
                       let countryName = d.properties.name;

                       // Normalize country names if necessary
                       if (countryName === "United States") countryName = "United States";
                       if (countryName === "Korea") countryName = "South Korea"; 
                       if (countryName === "Czech Republic") countryName = "Czechia"; 
                       if (countryName === "Turkey") countryName = "TÃ¼rkiye"; 

                       const population = populationByCountry[countryName];
                       return population ? colorScale(population) : "#ccc"; // Gray for missing data
                   })
                   .attr("stroke", "white")
                   .attr("stroke-width", 0.5);
            }
        }).catch(error => {
            console.error('Error loading or parsing data:', error);
        });
    </script>
</body>
</html>
